<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SOFUS: SOFUS (SIMD Optimized Fast Ultrasound Simulator)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_html_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">SOFUS<span id="projectnumber">&#160;..</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">SOFUS (SIMD Optimized Fast Ultrasound Simulator) </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section author"><dt>Author</dt><dd>Jens Munk Hansen </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2017</dd></dl>
<h1><a class="anchor" id="section_toc"></a>
Table of contents</h1>
<ul>
<li>
<a class="el" href="index.html#section_intro">Introduction</a> </li>
<li>
<a class="el" href="d7/d60/release_notes.html">Release Notes</a> </li>
<li>
<a class="el" href="d8/df1/build.html">Build and Run</a> </li>
<li>
<a class="el" href="de/df9/pagemath.html">Building Blocks</a> <ul>
<li>
<a class="el" href="de/df9/pagemath.html#section_primitives">Mathematical primitives</a> </li>
<li>
<a class="el" href="de/df9/pagemath.html#section_transducers">Transducer representation</a> </li>
<li>
<a class="el" href="de/df9/pagemath.html#section_fd_responses">Frequency domain responses</a> </li>
</ul>
</li>
<li>
<a class="el" href="index.html#section_gui">Graphical User Interface</a> <ul>
<li>
<a class="el" href="index.html#subsection_gui_usage">Usage</a> </li>
</ul>
</li>
<li>
<a class="el" href="d9/d40/article.html">Article</a> </li>
<li>
<a class="el" href="index.html#section_other">Other Stuff</a> <ul>
<li>
<a class="el" href="index.html#subsection_req_functional">Functional requirements</a> </li>
</ul>
</li>
<li>
<a class="el" href="index.html#subsection_examples">Examples of usage</a> <ul>
<li>
<a class="el" href="index.html#subsection_cpp_examples">C++ example</a> </li>
<li>
<a class="el" href="index.html#subsection_c_examples">ANSI-C example</a> </li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="section_intro"></a>
Introduction</h1>
<p >SOFUS is a framework and an application for simulating ultrasonic fields in frequency or time domain. The first part of this work was published in 2016 <a class="el" href="d0/de3/citelist.html#CITEREF_hansen2016">[7]</a> . The work is made primarily is C++ and is wrapped for use in Python with the extensible compiler, simplified wrapper and interface generator (SWIG) <a class="el" href="d0/de3/citelist.html#CITEREF_beazley2003">[2]</a> . The program is implemented to support modern single instruction, multiple data (SIMD) architectures - hence it's name SIMD Optimized Fast Ultrasound Simulator (SOFUS).</p>
<h1><a class="anchor" id="section_gui"></a>
Graphical User Interface</h1>
<p >An initial user interface has been created with Python using PyQt4. The intention is to make a native application, which is easier to distribute. For now, this is the only graphical interface to the library.</p>
<p >The GUI consists of a number of tabs, where each tab is used for a given purpose.</p><ul>
<li><p class="startli">Simulation</p>
<p class="startli">This tab is used for setting simulation parameters, e.g. integration order for time or frequency domain simulations. Global parameters such as speed-of-sound is also set here.</p>
</li>
<li><p class="startli">Transducer</p>
<p class="startli">This tab is used for defining the transducer by specifying a number of parameters and using one of the supported geometries </p><div class="image">
<img src="xdc_geometry.png" alt=""/>
</div>
</li>
<li><p class="startli">Field</p>
<p class="startli">The transmitted field can be computed on any axis-parallel 2D grid. If two singleton dimensions are selected, a 1D curve will be computed. </p><div class="image">
<img src="cw_field.png" alt=""/>
</div>
</li>
</ul>
<h2><a class="anchor" id="subsection_gui_usage"></a>
Usage</h2>
<p >Bla bla bla</p>
<h1><a class="anchor" id="section_other"></a>
Other Stuff</h1>
<h2><a class="anchor" id="subsection_req_functional"></a>
Functional requirements</h2>
<h2><a class="anchor" id="subsection_examples"></a>
Examples of usage</h2>
<h3><a class="anchor" id="subsection_cpp_examples"></a>
C++ example</h3>
<p >Below, the continuous wave field is computed for a 128-element linear array. </p><div class="fragment"><div class="line">  <span class="keyword">const</span> <span class="keywordtype">float</span> f0 = 1.0e6f;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">float</span> c  = 1500;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">size_t</span> nElements = 128;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">float</span> kerf   = 5.0e-4f;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">float</span> width  = 3e-3f;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">float</span> height = 50e-3f;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">size_t</span> nDiv = 4;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">size_t</span> nx = 170;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">size_t</span> nz = 250;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> pos = sps::unique_aligned_array_create&lt;float&gt;(nx*nz*3);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">float</span> d = (width+kerf)*nx;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">float</span> dx = (1.5f * d) / nx;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">float</span> dz = (2.0f * d) / nz;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">float</span> focus[3] = {0, 0, d};</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;float&gt; xs(nx);</div>
<div class="line">  std::vector&lt;float&gt; zs(nz);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">float</span> wx = <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(nx-1) / 2;</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0 ; i &lt; nx ; i++) {</div>
<div class="line">    xs[i] = (<span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(i) - wx) * dx;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0 ; i &lt; nz ; i++) {</div>
<div class="line">    zs[i] = <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(i) * dz;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_class" href="d3/d85/classfnm_1_1Aperture.html">fnm::Aperture&lt;float&gt;</a> a(nElements, width, kerf, height);</div>
<div class="line"> </div>
<div class="line">  a.F0Set(f0);</div>
<div class="line">  a.CSet(c);</div>
<div class="line">  a.NDivWSet(nDiv);</div>
<div class="line">  a.NDivHSet(nDiv);</div>
<div class="line">  a.NThreadsSet(4);</div>
<div class="line">  a.FocusSet(focus);</div>
<div class="line">  a.FocusingTypeSet(fnm::FocusingType::Rayleigh);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0 ; i &lt; nx ; i++) {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = 0 ; j &lt; nz ; j++) {</div>
<div class="line">      pos[3*(i*nz+j) + 0] = xs[i];</div>
<div class="line">      pos[3*(i*nz+j) + 1] = 0.0f;</div>
<div class="line">      pos[3*(i*nz+j) + 2] = zs[j];</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Output variables</span></div>
<div class="line">  <span class="keywordtype">size_t</span> nresults = 0;</div>
<div class="line">  std::complex&lt;float&gt;* results = NULL;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Compute pressure</span></div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line">  err = a.CalcCwFast(pos.get(), nx*nz, 3, &amp;results, &amp;nresults);</div>
<div class="line">  <a class="code hl_define" href="df/d7c/cenv_8h.html#aaa28560c075e826fbf4cabdd9e3b57c0">SPS_UNREFERENCED_PARAMETER</a>(err);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Clean-up</span></div>
<div class="line">  free(results);</div>
<div class="ttc" id="acenv_8h_html_aaa28560c075e826fbf4cabdd9e3b57c0"><div class="ttname"><a href="df/d7c/cenv_8h.html#aaa28560c075e826fbf4cabdd9e3b57c0">SPS_UNREFERENCED_PARAMETER</a></div><div class="ttdeci">#define SPS_UNREFERENCED_PARAMETER(x)</div><div class="ttdef"><b>Definition:</b> cenv.h:353</div></div>
<div class="ttc" id="aclassfnm_1_1Aperture_html"><div class="ttname"><a href="d3/d85/classfnm_1_1Aperture.html">fnm::Aperture</a></div><div class="ttdoc">Aperture class.</div><div class="ttdef"><b>Definition:</b> fnm.hpp:111</div></div>
</div><!-- fragment --><h3><a class="anchor" id="subsection_c_examples"></a>
ANSI-C example</h3>
<p >Below, the continuous wave field is computed for a 128-element linear array. </p><div class="fragment"><div class="line">  <span class="keyword">const</span> <span class="keywordtype">float</span> f0 = 1.0e6f;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">float</span> c  = 1500.0f;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">size_t</span> nElements = 64; <span class="comment">// 128</span></div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">float</span> kerf   = 5.0e-4f;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">float</span> width  = 3e-3f;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">float</span> height = 50e-3f;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">size_t</span> nDiv = 4;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">size_t</span> nx = 170;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">size_t</span> nz = 250;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">float</span>* pos = (<span class="keywordtype">float</span>*) malloc(nx*nz*3*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">float</span> d = (width+kerf)*nx;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">float</span> dx = (1.5f * d) / nx;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">float</span> dz = (2.0f * d) / nz;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">float</span> focus[3] = {0,0,d};</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">float</span>* xs = (<span class="keywordtype">float</span>*) malloc(nx*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div>
<div class="line">  <span class="keywordtype">float</span>* zs = (<span class="keywordtype">float</span>*) malloc(nz*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">float</span> wx = (nx-1.0f) / 2;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">size_t</span> i,j;</div>
<div class="line">  <span class="keywordflow">for</span> (i = 0 ; i &lt; nx ; i++) {</div>
<div class="line">    xs[i] = ( (float)i - wx) * dx;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">for</span> (i = 0 ; i &lt; nz ; i++) {</div>
<div class="line">    zs[i] = (float)i * dz;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_typedef" href="d5/dc6/if__fnm_8h.html#a65d818b8988858dbe35cfa00bb14596e">Aperture</a>* a = NULL;</div>
<div class="line">  <span class="keywordtype">int</span> err = <a class="code hl_function" href="d5/dc6/if__fnm_8h.html#aa90a1e4164b9caf7a57a4e493c591422">ApertureLinearCreate</a>(&amp;a, nElements, width, kerf, height);</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef FNM_CLOSURE_FUNCTIONS</span></div>
<div class="line">  ApertureRwFloatParamSet(a,F0,&amp;f0,0);</div>
<div class="line">  ApertureRwFloatParamSet(a,C,&amp;c,0);</div>
<div class="line">  ApertureRwFloatParamSet(a,Focus, &amp;focus[0], 1);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">  <span class="comment">// TODO: Narrow down interface</span></div>
<div class="line">  <a class="code hl_function" href="d5/dc6/if__fnm_8h.html#a220eb7f54d718b8e2a0c46697c5ff8d0">ApertureNDivWSet</a>(a,nDiv);</div>
<div class="line">  <a class="code hl_function" href="d5/dc6/if__fnm_8h.html#a0943ea8b4f92284e1319b86ab413a134">ApertureNDivHSet</a>(a,nDiv);</div>
<div class="line">  <a class="code hl_function" href="d5/dc6/if__fnm_8h.html#a06c4032fa002b92e256c7397eb720cb9">ApertureNThreadsSet</a>(a,1);</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_function" href="d5/dc6/if__fnm_8h.html#a8fbc2a25eb132734fe65c09a61e0fbc1">ApertureFocusingTypeSet</a>(a,Rayleigh);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (i = 0 ; i &lt; nx ; i++) {</div>
<div class="line">    <span class="keywordflow">for</span> (j = 0 ; j &lt; nz ; j++) {</div>
<div class="line">      pos[3*(i*nz+j) + 0] = xs[i];</div>
<div class="line">      pos[3*(i*nz+j) + 1] = 0.0f;</div>
<div class="line">      pos[3*(i*nz+j) + 2] = zs[j];</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">size_t</span> nresults = 0;</div>
<div class="line">  <span class="keywordtype">float</span> complex* results = NULL;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifndef FNM_DOUBLE_SUPPORT</span></div>
<div class="line">  err = <a class="code hl_function" href="d5/dc6/if__fnm_8h.html#a3125187f6b22120e4e4a7fdaca520de2">ApertureCalcCwFieldRef</a>(a, pos, nx*nz, 3, &amp;results, &amp;nresults);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">  err = ApertureCalcCwFast(a, pos, nx*nz, 3, &amp;results, &amp;nresults);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Clean-up</span></div>
<div class="line">  err = <a class="code hl_function" href="d5/dc6/if__fnm_8h.html#aa36f16c3d73530e812d53af2629df6b1">ApertureDestroy</a>(a);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (results) {</div>
<div class="line">    free(results);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  free(pos);</div>
<div class="line">  free(xs);</div>
<div class="line">  free(zs);</div>
<div class="line"> </div>
<div class="ttc" id="aif__fnm_8h_html_a06c4032fa002b92e256c7397eb720cb9"><div class="ttname"><a href="d5/dc6/if__fnm_8h.html#a06c4032fa002b92e256c7397eb720cb9">ApertureNThreadsSet</a></div><div class="ttdeci">int ApertureNThreadsSet(Aperture *obj, size_t nThreads)</div></div>
<div class="ttc" id="aif__fnm_8h_html_a0943ea8b4f92284e1319b86ab413a134"><div class="ttname"><a href="d5/dc6/if__fnm_8h.html#a0943ea8b4f92284e1319b86ab413a134">ApertureNDivHSet</a></div><div class="ttdeci">int ApertureNDivHSet(Aperture *obj, size_t nDiv)</div></div>
<div class="ttc" id="aif__fnm_8h_html_a220eb7f54d718b8e2a0c46697c5ff8d0"><div class="ttname"><a href="d5/dc6/if__fnm_8h.html#a220eb7f54d718b8e2a0c46697c5ff8d0">ApertureNDivWSet</a></div><div class="ttdeci">int ApertureNDivWSet(Aperture *obj, size_t nDiv)</div></div>
<div class="ttc" id="aif__fnm_8h_html_a3125187f6b22120e4e4a7fdaca520de2"><div class="ttname"><a href="d5/dc6/if__fnm_8h.html#a3125187f6b22120e4e4a7fdaca520de2">ApertureCalcCwFieldRef</a></div><div class="ttdeci">int ApertureCalcCwFieldRef(Aperture *obj, float *pos, size_t nPositions, size_t nDim, SPS_FCOMPLEX **odata, size_t *nOutPositions)</div></div>
<div class="ttc" id="aif__fnm_8h_html_a65d818b8988858dbe35cfa00bb14596e"><div class="ttname"><a href="d5/dc6/if__fnm_8h.html#a65d818b8988858dbe35cfa00bb14596e">Aperture</a></div><div class="ttdeci">struct Aperture Aperture</div><div class="ttdef"><b>Definition:</b> if_fnm.h:33</div></div>
<div class="ttc" id="aif__fnm_8h_html_a8fbc2a25eb132734fe65c09a61e0fbc1"><div class="ttname"><a href="d5/dc6/if__fnm_8h.html#a8fbc2a25eb132734fe65c09a61e0fbc1">ApertureFocusingTypeSet</a></div><div class="ttdeci">int ApertureFocusingTypeSet(Aperture *obj, int ftype)</div></div>
<div class="ttc" id="aif__fnm_8h_html_aa36f16c3d73530e812d53af2629df6b1"><div class="ttname"><a href="d5/dc6/if__fnm_8h.html#aa36f16c3d73530e812d53af2629df6b1">ApertureDestroy</a></div><div class="ttdeci">int ApertureDestroy(Aperture *obj)</div></div>
<div class="ttc" id="aif__fnm_8h_html_aa90a1e4164b9caf7a57a4e493c591422"><div class="ttname"><a href="d5/dc6/if__fnm_8h.html#aa90a1e4164b9caf7a57a4e493c591422">ApertureLinearCreate</a></div><div class="ttdeci">int ApertureLinearCreate(Aperture **obj, size_t nElements, float width, float kerf, float height)</div></div>
</div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue May 17 2022 09:21:07 for SOFUS by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
</small></address>
</body>
</html>
